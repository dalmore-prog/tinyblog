<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title><%= settings.site_name %></title>
    <link rel="preconnect" href="https://fonts.loli.net">
    <link rel="preconnect" href="https://gstatic.loli.net" crossorigin>
    <link href="https://fonts.loli.net/css2?family=Noto+Sans+SC:wght@400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="/css/style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-8108389486087485" crossorigin="anonymous"></script>
</head>
<body>

    <!-- Header -->
    <header class="site-header">
        <div class="header-inner">
            <a href="/" class="logo"><%= settings.site_name %></a>
            <div class="nav-menu">
                <a href="/" class="nav-item">é¦–é¡µ</a>
                <a href="/about" class="nav-item">å…³äº</a>
                <a href="#" class="nav-item" onclick="openContactModal(); return false;">è”ç³»å®¢æœ</a>
                <select id="theme-select" class="theme-select" onchange="changeTheme(this.value)">
                    <option value="light">â˜€ï¸ æµ…è‰²</option>
                    <option value="dark">ğŸŒ™ æ·±è‰²</option>
                    <option value="sepia">ğŸ“– æŠ¤çœ¼</option>
                </select>
            </div>
        </div>
    </header>

    <!-- Main Layout -->
    <div class="main-container">
        
        <!-- Left Column: Articles -->
        <div class="content-column">
            <% if (articles && articles.length > 0) { %>
                <% articles.forEach(function(article) { %>
                    <article class="article-card">
                        <h2 class="article-title">
                            <a href="/article/<%= article.id %>"><%= article.title %></a>
                        </h2>
                        <div class="article-meta">
                            <i class="far fa-calendar-alt"></i> <%= article.date %>
                        </div>
                        <div class="article-summary">
                            <%= article.summary %>
                        </div>
                        <a href="/article/<%= article.id %>" class="read-more">é˜…è¯»å…¨æ–‡ &rarr;</a>
                    </article>
                <% }); %>
            <% } else { %>
                <div class="article-card" style="text-align: center; padding: 50px;">
                    <p>æš‚æ— æ–‡ç« ï¼Œè¯·ç™»å½•åå°å‘å¸ƒã€‚</p>
                </div>
            <% } %>

            <!-- Pagination -->
            <% if (typeof pagination !== 'undefined' && pagination.totalPages > 1) { %>
                <div class="pagination">
                    <% if (pagination.page > 1) { %>
                        <a href="/?page=<%= pagination.page - 1 %>&limit=<%= pagination.limit %>" class="page-link">&laquo; ä¸Šä¸€é¡µ</a>
                    <% } else { %>
                        <span class="page-link disabled">&laquo; ä¸Šä¸€é¡µ</span>
                    <% } %>
                    
                    <span class="page-info">ç¬¬ <%= pagination.page %> / <%= pagination.totalPages %> é¡µ</span>
                    
                    <% if (pagination.page < pagination.totalPages) { %>
                        <a href="/?page=<%= pagination.page + 1 %>&limit=<%= pagination.limit %>" class="page-link">ä¸‹ä¸€é¡µ &raquo;</a>
                    <% } else { %>
                        <span class="page-link disabled">ä¸‹ä¸€é¡µ &raquo;</span>
                    <% } %>
                    
                    <select onchange="window.location.href='/?page=1&limit=' + this.value" class="limit-select">
                        <option value="5" <%= pagination.limit === 5 ? 'selected' : '' %>>5æ¡/é¡µ</option>
                        <option value="10" <%= pagination.limit === 10 ? 'selected' : '' %>>10æ¡/é¡µ</option>
                        <option value="20" <%= pagination.limit === 20 ? 'selected' : '' %>>20æ¡/é¡µ</option>
                    </select>
                </div>
            <% } %>
        </div>

        <!-- Right Column: Sidebar -->
        <aside class="sidebar-column">
            <div class="sidebar-widget">
                <h3 class="widget-title">å…³äºæœ¬ç«™</h3>
                <p style="font-size: 0.9rem; color: var(--text-secondary);">
                    è¿™æ˜¯ä¸€ä¸ªåŸºäºå¡å¯†éªŒè¯çš„ç§æœ‰çŸ¥è¯†åº“ã€‚æ‰€æœ‰å†…å®¹å‡ä¸ºåŸåˆ›å¹²è´§ï¼Œè§£é”åæ°¸ä¹…é˜…è¯»ã€‚
                </p>
            </div>
            
            <div class="sidebar-widget">
                <h3 class="widget-title">ğŸ”¥ çƒ­é—¨æ–‡ç« </h3>
                <ul class="hot-articles-list">
                    <% if (hotArticles && hotArticles.length > 0) { %>
                        <% hotArticles.forEach(function(article, index) { %>
                            <li>
                                <span class="rank <%= index < 3 ? 'top-rank' : '' %>"><%= index + 1 %></span>
                                <a href="/article/<%= article.id %>" title="<%= article.title %>"><%= article.title %></a>
                                <span class="views"><i class="fas fa-eye"></i> <%= article.views %></span>
                            </li>
                        <% }); %>
                    <% } else { %>
                        <li style="color: var(--text-secondary); font-size: 0.9rem;">æš‚æ— çƒ­é—¨æ–‡ç« </li>
                    <% } %>
                </ul>
            </div>
        </aside>

    </div>

    <!-- Footer -->
    <footer class="site-footer">
        <div class="footer-links">
            <a href="/about">å…³äºæˆ‘ä»¬</a>
            <a href="#" onclick="openContactModal(); return false;">è”ç³»æ–¹å¼</a>
            <a href="/privacy">éšç§æ”¿ç­–</a>
        </div>
        <p>&copy; <%= new Date().getFullYear() %> <%= settings.site_name %>. All Rights Reserved.</p>
    </footer>

    <!-- Contact Modal -->
    <div class="modal-overlay" id="contact-modal" style="display: none;">
        <div class="modal">
            <button class="modal-close" onclick="closeContactModal()"><i class="fas fa-times"></i></button>
            <h3>è”ç³»å®¢æœ</h3>
            <p>æ‰«æä¸‹æ–¹äºŒç»´ç æ·»åŠ å®¢æœå¾®ä¿¡</p>
            <img src="<%= settings.wechat_qr_image %>" alt="QR Code">
            <p style="font-size: 0.9rem; margin-top: 15px;">è·å–æœ€æ–°æ–‡ç« å¡å¯† / å•†åŠ¡åˆä½œ</p>
        </div>
    </div>

    <script>
        // Contact Modal Logic
        function openContactModal() {
            document.getElementById('contact-modal').style.display = 'flex';
        }
        function closeContactModal() {
            document.getElementById('contact-modal').style.display = 'none';
        }
        document.getElementById('contact-modal').addEventListener('click', function(e) {
            if (e.target === this) closeContactModal();
        });

        // Theme Logic
        const savedTheme = localStorage.getItem('theme') || '<%= settings.default_theme || "light" %>';
        document.body.setAttribute('data-theme', savedTheme);
        document.getElementById('theme-select').value = savedTheme;

        function changeTheme(theme) {
            document.body.setAttribute('data-theme', theme);
            localStorage.setItem('theme', theme);
        }
    </script>
</body>
</html>